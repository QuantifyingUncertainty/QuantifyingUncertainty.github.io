<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Quantifyinguncertainty.GitHub.io by QuantifyingUncertainty</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/main.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>

      <header>
        <h1>Quantifyinguncertainty.GitHub.io</h1>
        <p></p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        <a href="https://github.com/QuantifyingUncertainty" class="button fork"><strong>View On GitHub</strong></a>
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>
        <ul></ul>
      </nav>
      <section>
        <h2>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h2>

<ol>
<li><a href="#intro">Introduction</a></li>
<li><a href="#aws-setup">Amazon Web Services Setup</a></li>
<li><a href="#gmh-on-aws">Using Generalized Metropolis-Hastings on AWS</a></li>
<li><a href="#gmh-on-box">Using Generalized Metropolis-Hastings on JuliaBox</a></li>
<li><a href="#gmh-on-local">Using Generalized Metropolis-Hastings on local machine</a></li>
<li><a href="#gmh-ami-setup">Setting up Amazon Machine Images with Generalized Metropolis-Hastings</a></li>
</ol>

<h2>
<a id="1-introduction" class="anchor" href="#1-introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="intro"></a>1. Introduction</h2>

<p>The "Quantifying Uncertainty" project develops code, examples and documentation for the Generalized Metropolis-Hastings (GMH) algorithm proposed in <a href="#calder14">(Calderhead, 2014)</a>. It implements a class of parallelized Monte-Carlo Markov Chains methods (MCMC) that can be used to estimate model parameters of complex physical and biological processes. Details of the GMH algorithm can be found in the scientific publications listed in the <a href="#refs">References</a>.</p>

<p>The GMH MCMC library is written in <a href="http://julialang.org">Julia</a>, a language designed for fast and flexible mathematical and technical computing. It combines aspects of R, MATLAB and Python and can be easily parallelized to take advantage of multi-processor machines and clusters. It has an active developer community making it available on Windows, Linux and Mac, and via cloud computing services such as <a href="http://juliabox.org/">JuliaBox</a> or <a href="http://aws.amazon.com/">Amazon Web Services</a> (AWS).</p>

<p>There are 2 different, potentially overlapping, situations in which to use the GMH library:</p>

<ol>
<li>To replicate MCMC experiments from <a href="#refs">published scientific papers</a>. In this case, we recommend to run the experiments from a pre-compiled machine image published on AWS. The machine images contain all the required code, libraries and data to run the MCMC experiments for a particular article, substantially reducing your set-up time. By following the AWS setup steps in Section 2 and 3 below, you will be able to run these experiments via a web browser such as Firefox or Chrome.</li>
<li>To use the GMH library to design your own MCMC experiments. In addition to using GMH on AWS, alternative ways are to download the GMH repository from GitHub to your local machine or to work via <a href="http://juliabox.org">JuliaBox</a>. </li>
</ol>

<p>The GMH code and documentation resides on GitHub in <a href="https://github.com/QuantifyingUncertainty/GeneralizedMetropolisHastings.jl">GeneralizedMetropolisHastings.jl</a>. Examples to help users to develop their own MCMC simulations are included in another repository, <a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl">GMH-Examples.jl</a>. The remainder of this documentation outlines how to setup GMH on different platforms. It explains in detail how to sign up for AWS (Section 2), how to use GMH on AWS (Section 3), on JuliaBox (Section 4) or on your local machine (Section 5) and how to publish your own AMIs to accompany the publication of scientific articles that use the GMH repository (Section 6).</p>

<h3>
<a id="table-1-acronyms" class="anchor" href="#table-1-acronyms" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="acronyms"></a>Table 1. Acronyms</h3>

<table>
<thead>
<tr>
<th align="center">Acronym</th>
<th align="left">Full Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><strong>AMI</strong></td>
<td align="left">Amazon Machine Image</td>
<td align="left">A pre-configured software image of a virtual server</td>
</tr>
<tr>
<td align="center"><strong>AWS</strong></td>
<td align="left">Amazon Web Services</td>
<td align="left">Amazon's cloud computing services</td>
</tr>
<tr>
<td align="center"><strong>EC2</strong></td>
<td align="left">Elastic Cloud Computing</td>
<td align="left">AWS service to run virtual servers</td>
</tr>
<tr>
<td align="center"><strong>IAM</strong></td>
<td align="left">Identity and Access Management</td>
<td align="left">AWS service to create users</td>
</tr>
<tr>
<td align="center"><strong>GMH</strong></td>
<td align="left">Generalized Metropolis Hastings</td>
<td align="left">Parallel Metropolis-Hastings from <a href="#calder14">(Calderhead, 2014)</a>
</td>
</tr>
<tr>
<td align="center"><strong>MCMC</strong></td>
<td align="left"><a href="https://en.wikipedia.org/wiki/Markov_chain_Monte_Carlo">Monte-Carlo Markov Chain</a></td>
<td align="left">Class of algorithms to sample from unknown probability distributions</td>
</tr>
</tbody>
</table>

<h2>
<a id="2-aws-setup" class="anchor" href="#2-aws-setup" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="aws-setup"></a>2. AWS Setup</h2>

<h3>
<a id="step-21-sign-up-for-an-aws-account" class="anchor" href="#step-21-sign-up-for-an-aws-account" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="aws-signup"></a>Step 2.1: Sign up for an AWS account</h3>

<p>This step requires a credit card to set up an account and a phone number to receive a security callback. By using Amazon's "Free Tier", it is possible to avoid being billed, but the credit card is still required. Follow the instructions in the AWS documentation:</p>

<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html</a></p>

<p>You should complete the following steps: </p>

<ol>
<li>Create an AWS account</li>
<li>Create an IAM user</li>
<li>Create a Key Pair</li>
<li>Create a Security Group</li>
</ol>

<h3>
<a id="table-2-required-security-group-settings" class="anchor" href="#table-2-required-security-group-settings" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="sg-rules"></a>Table 2. Required Security Group Settings</h3>

<p>When setting up the Security Group, specify the following inbound rules:</p>

<table>
<thead>
<tr>
<th align="left">Service</th>
<th align="center">Port</th>
<th align="center">Source</th>
<th align="left">Access</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">SSH</td>
<td align="center">22</td>
<td align="center">0.0.0.0/0</td>
<td align="left">SSH command-line access</td>
</tr>
<tr>
<td align="left">Custom TCP Rule</td>
<td align="center">8898</td>
<td align="center">0.0.0.0/0</td>
<td align="left">Access to IJulia server</td>
</tr>
<tr>
<td align="left">Custom TCP Rule</td>
<td align="center">49152 - 65535</td>
<td align="center">127.0.0.1/32</td>
<td align="left">Localhost ports for IJulia server</td>
</tr>
</tbody>
</table>

<p>The “0.0.0.0/0” in the “Source” field means that incoming connections from any IP address are allowed. You can make the security group more secure by only allowing incoming connections from known IP addresses (e.g., "My IP" in the EC2 security group  control panel). This means, however, that every time you change your local IP address you will have to update the Security Group. As long as you are careful in implementing the security steps outlined in Section 3, the above settings should be fine.</p>

<p>The entire process of setting up an AWS account is likely to take between 1 and 2 hours, depending on your familiarity with AWS. These steps need to be completed only once.</p>

<h3>
<a id="step-22-check--the-aws-region" class="anchor" href="#step-22-check--the-aws-region" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="aws-region"></a>Step 2.2: Check  the AWS region</h3>

<p>This step typically needs to be performed only once - especially upon first signing up for AWS or if you cannot find the published AMIs listed in Section 3. Amazon regions (data centers) are independent of each other. In order to find the GMH AMIs, you need to be logged into the correct region. At this moment, the only region in which the GMH AMIs are published is <strong>Ireland</strong>. You can check and change the region in the top right corner of the AWS and EC2 dashboards, between your IAM username and “Support”.</p>

<h2>
<a id="-3-using-gmh-on-aws" class="anchor" href="#-3-using-gmh-on-aws" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="gmh-on-aws"></a> 3. Using GMH on AWS</h2>

<h3>
<a id="table-3-published-amis" class="anchor" href="#table-3-published-amis" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="ami-pub"></a>Table 3: Published AMIs</h3>

<table>
<thead>
<tr>
<th align="left">AMI Name</th>
<th align="left">Description</th>
<th align="left">Relevant Publication</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">GMH-JULIA0.3-GENERIC</td>
<td align="left">Julia v0.3.11 + GMH</td>
<td align="left"><a href="#calder14">(Calderhead,2014)</a></td>
</tr>
</tbody>
</table>

<h3>
<a id="step-31-launch-a-published-ami" class="anchor" href="#step-31-launch-a-published-ami" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="launch-ami"></a>Step 3.1: Launch a published AMI</h3>

<h4>
<a id="step-311-choose-an-ami" class="anchor" href="#step-311-choose-an-ami" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.1: Choose an AMI</h4>

<p>Once logged into the AWS dashboard, go to the EC2 console. Select <strong>Instances</strong> in the left-hand menu, and click the <strong>Launch</strong> button at the top of the panel. Select <strong>Community AMIs</strong> from the left-hand menu and in the search box that appears, copy-paste one of the published AMI names from Table 3. Click the <strong>Select</strong> button to launch the AMI.</p>

<p><strong>Troubleshooting</strong>: if the AMI does not appear in the list, then <a href="#aws-region">check the AWS region</a>.</p>

<h4>
<a id="step-312-choose-an-instance-type" class="anchor" href="#step-312-choose-an-instance-type" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.2: Choose an Instance Type</h4>

<p>Here you select the physical hardware on which to run. To avoid being billed, select an instance labelled with "Free tier eligible" (currently the t2.micro). Click <strong>Next: Configure Instance Details.</strong></p>

<h4>
<a id="step-313-configure-instance-details" class="anchor" href="#step-313-configure-instance-details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.3: Configure Instance Details</h4>

<p>From the "Subnet" drop-down list, select a subnet that corresponds to a particular availability zone, which is important if you will also attach an existing EBS-backed volume to contain your data (this is optional - see Step 3.3 below). Make a note of which availability zone you select (currently <strong>eu-west-1a</strong>, <strong>1b</strong> or <strong>1c</strong>). Choose <strong>Next: Add Storage</strong> at the bottom of the page.</p>

<h4>
<a id="step-314-add-storage" class="anchor" href="#step-314-add-storage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.4: Add Storage</h4>

<p><strong>Optional</strong>: you are welcome - if required - to add an additional drive to contain your private data and code. This can either be done on this page and/or at a later stage, in which case see <a href="#add-ebs">Add an EBS volume</a>.) Click <strong>Next: Tag Instance.</strong></p>

<h4>
<a id="step-315-tag-instance" class="anchor" href="#step-315-tag-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.5: Tag Instance</h4>

<p><strong>Optional</strong>: add descriptive tags for your instance. Then click <strong>Next: Configure Security Group</strong>.</p>

<h4>
<a id="step-316-configure-security-group" class="anchor" href="#step-316-configure-security-group" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.6: Configure Security Group</h4>

<p>Select the radio button <strong>Select an existing security group</strong> and select the Security Group for IJulia access that you made in <a href="#sg-rules">Step 2.1</a>. Click <strong>Next: Review and Launch</strong>.</p>

<h4>
<a id="step-317-review-and-launch" class="anchor" href="#step-317-review-and-launch" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3.1.7: Review and Launch</h4>

<p>It is safe to ignore the warning that the Security Group is open to the world (if the security steps outlined in Step 3.4 are adhered to). Click <strong>Launch</strong> at the bottom of the page. A pop-up window comes up. If you previously made a Key Pair, select <strong>Choose an existing key pair</strong>. Otherwise select <strong>Create a new key pair</strong> and make sure to download the private key to a safe location on your local machine.</p>

<p>Click <strong>Launch Instances</strong>. On the next window, <strong>Launch Status</strong>, click <strong>View Instances</strong>, which takes you to the Instances page. Once the <strong>Instance State</strong> becomes green and says <strong>running</strong>, you can connect via SSH. </p>

<h3>
<a id="step-32-connect-to-a-running-instance" class="anchor" href="#step-32-connect-to-a-running-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="ami-connect"></a>Step 3.2: Connect to a running instance</h3>

<p>The username for this machine is <strong>ubuntu</strong>. There is no password, but verification occurs with the Key Pair you created previously.</p>

<p>Instructions on how to connect to the instance via SSH can be found here:</p>

<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-connect-to-instance-linux.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-connect-to-instance-linux.html</a></p>

<p>If you are using Windows and PuTTy, follow these instructions to transform your local key:
<a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html#create-a-key-pair">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/get-set-up-for-amazon-ec2.html#create-a-key-pair</a></p>

<p><strong>Troubleshooting</strong>: if you cannot connect, then it may be because of the Security Group settings you launched the machine with. Check that they correspond to the ones in <a href="#sg-rules">Table 2</a>. If you opted to not allow access from all IP addresses (i.e., did not select 0.0.0.0/0 in <a href="sg-rules">Table 2</a>), then make sure that the IP address in the Security Group is the same as the IP address of your local machine (visit <a href="http://myipaddress.com">http://myipaddress.com</a> to find out).</p>

<h3>
<a id="step-33-add-an-ebs-volume" class="anchor" href="#step-33-add-an-ebs-volume" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="add-ebs"></a>Step 3.3: Add an EBS Volume</h3>

<p><strong>Optional</strong>: you can add additional storage to hold your data and experiments by following these instructions: </p>

<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-add-volume-to-instance.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-add-volume-to-instance.html</a> </p>

<p>When connected to the instance via SSH, mount the new volume in the home folder rather than in the location suggested in the AWS user guide, for example:</p>

<pre><code>sudo mount /dev/xvdf ~/data
</code></pre>

<p>If you create an EBS volume, limit the size to a few GB as the Free Tier only comes with 30GB of free storage for all volumes combined.</p>

<h3>
<a id="step-34-secure-the-notebook-server" class="anchor" href="#step-34-secure-the-notebook-server" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="secure-jupyter"></a>Step 3.4: Secure the Notebook server</h3>

<h4>
<a id="step-341-prepare-a-hashed-password" class="anchor" href="#step-341-prepare-a-hashed-password" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="password-jupyter"></a>Step 3.4.1: Prepare a Hashed Password</h4>

<p>At the SSH command prompt, type:</p>

<pre><code>ipython
</code></pre>

<p>In the IPython environment, execute:</p>

<pre><code>In [1]: from notebook.auth import passwd
In [2]: passwd()
</code></pre>

<p>Type your preferred password twice. You will then see an SHA hash of the chosen password such as:</p>

<pre><code>Out [1]: 'sha1:328ae2b31aaa:82ecb6479a0d5c9d999c36f7949b26e78c69133e'
</code></pre>

<p>Copy-and-paste this to a secure location as we will need it in the following step. Exit the ipython environment by typing <strong>exit()</strong></p>

<p><strong>Important</strong>: select a secure password, consisting preferably of 3 unconnected words, e.g., "apple-spring-saxophone". If the password you select here is not secure, then your AWS server is vulnerable to attack as the Notebook server allows any system command to be executed via a web browser.</p>

<h4>
<a id="step-342-add-the-hashed-password-to-your-notebook-configuration-file" class="anchor" href="#step-342-add-the-hashed-password-to-your-notebook-configuration-file" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="password-file"></a>Step 3.4.2: Add the hashed password to your Notebook configuration file</h4>

<p>Add your own SHA password to the file <strong>/home/ubuntu/.jupyter/jupyter_notebook_config.py</strong>:</p>

<pre><code>c.NotebookApp.password = u'sha1:67c9e60bb8b6:9ffede0825894254b2e042ea597d771089e11aed'
</code></pre>

<p><strong>Tip</strong>: if you are unfamiliar with command-line Linux, the simplest text editor is <strong>pico</strong>.:</p>

<pre><code>pico ~/.jupyter/jupyter_notebook_config.py
</code></pre>

<h4>
<a id="step-343-using-ssl-for-encrypted-communication" class="anchor" href="#step-343-using-ssl-for-encrypted-communication" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="ssl-jupyter"></a>Step 3.4.3: Using SSL for encrypted communication</h4>

<p>You must create a self-signed SSL certificate to encrypt the communication to the server. At the SSH command prompt, type the following:</p>

<pre><code>cd ~/.certificates
openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout mykey.pem -out mycert.pem
chmod 400 mykey.pem mycert.pem
</code></pre>

<p>Press enter to accept all the default values. Please keep the locations and names of the key file and certificate file as above because the <strong>jupyter_notebook_config.py</strong> file has been pre-configured to find the files in that location.</p>

<h3>
<a id="step-35-launch-a-notebook-server" class="anchor" href="#step-35-launch-a-notebook-server" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="launch-jupyter"></a>Step 3.5: Launch a Notebook server</h3>

<p>On the SSH command line, you can start the Notebook server:</p>

<pre><code>cd ~
jupyter notebook &amp;
</code></pre>

<p>The ampersand means that the notebook server is placed in the background. Once you see that the server is running on Port 8998, you can logout of the SSH session, and the server will continue to run in the background until the instance is stopped.</p>

<p>The Jupyter server prints status messages to the console. You can also redirect this output to a log file:</p>

<pre><code>jupyter notebook &gt; ~/.jupyter/jupyter_output.log 2&gt;&amp;1 &amp;
</code></pre>

<h3>
<a id="step-36-login-to-the-notebook-server" class="anchor" href="#step-36-login-to-the-notebook-server" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="%E2%80%9Dlogin-jupyter%E2%80%9D/">Step 3.6 Login to the Notebook server</a>
</h3>

<p>To connect to the Notebook server via your browser, get the public IP address of your running instance from the EC2 console (the “Instances” page) and type it in the address bar of your web browser. Make sure to use <strong>https</strong> to connect (rather than plain <strong>http</strong>).</p>

<pre><code>https://xxx.xxx.xxx.xxx:8998
</code></pre>

<p>The browser will complain that the connection is not private because the identity of the self-signed SSL certificate could not be checked. You can safely ignore these warnings. </p>

<p>You are now at the notebook server login page. Type the plain text password you <a href="#password-jupyter">created above</a>. </p>

<h3>
<a id="step-37-using-the-notebook-server" class="anchor" href="#step-37-using-the-notebook-server" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="%E2%80%9Duse-jupyter%E2%80%9D/">Step 3.7: Using the Notebook server</a>
</h3>

<p>Please consider A) or B) below :</p>

<p><em>A) If you started one of the published AMIs which contain the MCMC experiments for specific papers</em></p>

<p>Under the <strong>Files</strong> tab in the notebook server, you will see the corresponding experiments in Notebook files. Notebooks contain both code and documentation, so please refer to these notebooks for further information.</p>

<p>You can start individual notebooks by navigating to one of the folders containing a notebook, and double-clicking it. You can also start a command-line terminal by selecting “New/Terminal” from the right-hand side of the screen. For further information on the notebook server interface, see the <a href="http://jupyter.readthedocs.org/en/latest/">Jupyter</a> documentation. </p>

<p><em>B) If you started a “generic” GMH AMI</em></p>

<p>You will not see any files listed, but you can install the <strong>GMH-Examples.jl</strong> package to explore example Julia notebooks and scripts that explain how to use the GMH library. Execute the following git command in a terminal (either via the SSH terminal or a Jupyter terminal in the browser window):</p>

<pre><code>git clone https://github.com/QuantifyingUncertainty/GMH-Examples.jl.git
</code></pre>

<p>The repository is now accessible under the <strong>Files</strong> tab of the notebook server. Please refer to the <a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl">GMH-Examples.jl</a> documentation on how to use this package.</p>

<h3>
<a id="step-38-stoppingterminating-the-notebook-server-and-aws-machine" class="anchor" href="#step-38-stoppingterminating-the-notebook-server-and-aws-machine" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="%E2%80%9Dstop-jupyter%E2%80%9D/">Step 3.8: Stopping/Terminating the Notebook server and AWS machine</a>
</h3>

<p>When finished, there are multiple levels of halting/terminating the Notebook server and AWS machine:</p>

<ol>
<li>Logout of the notebook server by clicking the “Logout” button at the top right of the server screen. The server will continue to be accessible on Port 8998 for future login.</li>
<li>The Notebook server can be halted via the SSH terminal (e.g., using the Unix <strong>kill</strong> command).</li>
<li>In the AWS/EC2 dashboard, under the <strong>Instances</strong> tab, you can temporarily stop the running EC2 instance, by selecting the instance and clicking <strong>Actions/Instance State/Stop</strong> at the top of the screen. This will power down the computer, but it will remain available to restart later. Note that, unless you <strong>Stop</strong> an EC2 instance, the running time is chargeable, even if your computer is idle (unless you operate within Amazon’s “Free Tier”).</li>
<li>You can also <strong>Terminate</strong> an instance. This means that the resources associated with the instance will be deleted. In other words, an instance that has been terminated cannot be restarted, and you would need to setup the machine anew.</li>
</ol>

<h2>
<a id="-4-using-gmh-in-juliabox" class="anchor" href="#-4-using-gmh-in-juliabox" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="gmh-on-box"></a> 4. Using GMH in JuliaBox</h2>

<h3>
<a id="step-41-sign-in-to-juliabox" class="anchor" href="#step-41-sign-in-to-juliabox" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4.1: Sign in to JuliaBox</h3>

<p>Go to <a href="https://juliabox.org">https://juliabox.org</a> and sign in with your Google credentials.</p>

<h3>
<a id="step-42-install-the-generalizedmetropolishastingsjl-package" class="anchor" href="#step-42-install-the-generalizedmetropolishastingsjl-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4.2: Install the GeneralizedMetropolisHastings.jl package.</h3>

<p>At the top of the JuliaBox window, select <strong>Terminal</strong>. Execute the following command to install GMH for the Julia v0.3.11 installation of JuliaBox (the currently preferred version for GMH). This will install GMH in the package folder <strong>/home/juser/.julia/0.3</strong>.</p>

<pre><code>/opt/julia-0.3.11/bin/julia -e ‘Pkg.clone("git://github.com/QuantifyingUncertainty/GeneralizedMetropolisHastings.jl")’
</code></pre>

<p>You can test if GMH installed correctly and is compatible with this particular JuliaBox installation by running the GMH tests:</p>

<pre><code>/opt/julia-0.3.11/bin/julia -e ‘include(normpath(Pkg.dir("GeneralizedMetropolisHastings"),"test/runtests.jl"))’
</code></pre>

<h3>
<a id="step-43-sync-the-gmh-examples-repository" class="anchor" href="#step-43-sync-the-gmh-examples-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4.3 Sync the GMH-Examples repository</h3>

<p>Sync the GMH-Examples.jl repository from GitHub to your JuliaBox home folder. At the top of the JuliaBox window, select <strong>Sync</strong>.  Add the following repository to the “Git Repositories”.</p>

<p><a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl.git">https://github.com/QuantifyingUncertainty/GMH-Examples.jl.git</a></p>

<p>Paste this into the “Git Clone URL”. Accept “master” as branch, “GMH-Examples.jl” as location, and press “+” to add the repository. This will now download the package to the specified location. </p>

<p>Please refer to the documentation of the <a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl">GMH-Examples-jl</a> repository for details of how to use it.</p>

<h1>
<a id="5-using-gmh-locally" class="anchor" href="#5-using-gmh-locally" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="gmh-on-local"></a>5. Using GMH locally</h1>

<h3>
<a id="step-51-install-julia--ide" class="anchor" href="#step-51-install-julia--ide" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5.1: Install Julia + IDE</h3>

<p>Install Julia from <a href="http://julialang.org/downloads/">http://julialang.org/downloads/</a>. You can also install a development environment. On Windows, <a href="http://junolab.org/">Juno</a> is recommended.</p>

<h3>
<a id="step-52-install-the-gmh-package" class="anchor" href="#step-52-install-the-gmh-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5.2: Install the GMH package</h3>

<p>Start Julia and execute the following commands:</p>

<pre><code>Pkg.clone("git://github.com/QuantifyingUncertainty/GeneralizedMetropolisHastings.jl")
</code></pre>

<p>This will install the GMH repository and the required packages.</p>

<p>The GMH repository has been tested with Julia v0.3.8-v0.3.11. Julia and its packages are in rapid development and you may wish to test your current Julia installation with GMH. You can do so by running the GMH tests:</p>

<pre><code>include(normpath(Pkg.dir("GeneralizedMetropolisHastings"),"test/runtests.jl"))
</code></pre>

<h3>
<a id="step-53-install-the-gmh-examples-repository" class="anchor" href="#step-53-install-the-gmh-examples-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 5.3 Install the GMH-Examples repository</h3>

<p>Install the GMH-Examples.jl repository from GitHub in a local folder. Instructions on how to do this for your platform can be found on <a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl">GitHub</a>. </p>

<p>Please refer to the documentation of the <a href="https://github.com/QuantifyingUncertainty/GMH-Examples.jl">GMH-Examples-jl</a> repository on how to use it.</p>

<h2>
<a id="6-configure-amis-with-gmh" class="anchor" href="#6-configure-amis-with-gmh" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="gmh-ami-setup"></a>6. Configure AMIs with GMH</h2>

<h3>
<a id="61-ami-with-julia-v0311" class="anchor" href="#61-ami-with-julia-v0311" aria-hidden="true"><span class="octicon octicon-link"></span></a><a name="ami-julia0.3"></a>6.1 AMI with Julia v0.3.11</h3>

<h4>
<a id="step-611-launch-and-connect-to-a-fresh-ec2-instance" class="anchor" href="#step-611-launch-and-connect-to-a-fresh-ec2-instance" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 6.1.1 Launch and connect to a fresh EC2 instance</h4>

<p>Follow the instructions of [Step 3.1](#launch-ami] and <a href="#ami-connect">Step 3.2</a>, but rather than selecting a published AMI via the Community AMIs start from a Ubuntu Server 14.04LTS.</p>

<h4>
<a id="step-612-install-julia-03-currently-0311" class="anchor" href="#step-612-install-julia-03-currently-0311" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 6.1.2 Install Julia 0.3 (currently 0.3.11)</h4>

<pre><code>sudo add-apt-repository ppa:staticfloat/julia-deps
sudo add-apt-repository ppa:staticfloat/juliareleases
sudo apt-get update
sudo apt-get -y install build-essential
sudo apt-get -y install julia0.3
</code></pre>

<p>The <strong>build-essential</strong> package contains essential build tools that Julia needs to build some of its own packages. If the installation was successful, then it is now possible to run Julia at the command prompt. You can test this by typing <strong>julia</strong>. Exit from Julia by typing <strong>exit()</strong>.</p>

<h4>
<a id="step-713-install-gmh-ijulia-and-additional-julia-packages" class="anchor" href="#step-713-install-gmh-ijulia-and-additional-julia-packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 7.1.3 Install GMH, IJulia and additional Julia packages</h4>

<pre><code>julia -e 'Pkg.clone("git://github.com/QuantifyingUncertainty/GeneralizedMetropolisHastings.jl")'
</code></pre>

<p>The above step will install all packages required for GMH. The IJulia package (which enables access to Julia via a web browser) installs its own <a href="http://jupyter.org">Jupyter</a> server. To add this server to the path so it can be started from the command line, add this path to <strong>/home/ubuntu/.profile</strong>:</p>

<pre><code>echo 'PATH="$PATH:/home/ubuntu/.julia/v0.3/Conda/deps/usr/bin"' &gt;&gt; /home/ubuntu/.profile
</code></pre>

<h4>
<a id="step-614-prepare-the-ijulia-notebook-server-for-remote-access" class="anchor" href="#step-614-prepare-the-ijulia-notebook-server-for-remote-access" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 6.1.4 Prepare the IJulia Notebook server for remote access</h4>

<p>Create a file <strong>/home/ubuntu/.jupyter/jupyter_notebook_config.py</strong> with the following lines:</p>

<pre><code>c.NotebookApp.ip = '*'
c.NotebookApp.port = 8998
c.NotebookApp.open_browser = False
c.NotebookApp.keyfile = u'/home/ubuntu/.certificates/mykey.pem'
c.NotebookApp.certfile = u'/home/ubuntu/.certificates/mycert.pem'
c.NotebookApp.password = u''
</code></pre>

<p>The keyfile, certfile and password will need to be added by the user when customizing this AMI. </p>

<p>Make the <strong>jupyter_notebook_config.py</strong> file readable and writable only to the local user:</p>

<pre><code>chmod 600 ~/.jupyter/jupyter_notebook_config.py
</code></pre>

<p>Prepare a directory for the SSL certificates:</p>

<pre><code>mkdir ~/.certificates
</code></pre>

<h4>
<a id="step-615-create-the-ami" class="anchor" href="#step-615-create-the-ami" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 6.1.5 Create the AMI</h4>

<p>Before creating the AMI, you must remove the SSH key with which the instance was started, as well as any command line histories:</p>

<pre><code>sudo find /home/ubuntu/.*history -exec rm -f {} \;
sudo find /root/.ssh/authorized_keys -exec rm -f {} \;
sudo find /home/ubuntu/.ssh/authorized_keys -exec rm -f {} \;
</code></pre>

<p>Further security guidelines can be found in: <a href="https://aws.amazon.com/articles/0155828273219400">https://aws.amazon.com/articles/0155828273219400</a></p>

<p>Stop the instance customised above from the EC2 console, and follow these steps to create the AMI:</p>

<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/creating-an-ami-ebs.html#how-to-create-ebs-ami">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/creating-an-ami-ebs.html#how-to-create-ebs-ami</a></p>

<p>Here are general guidelines to share a public AMI:</p>

<p><a href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharing-amis.html">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/sharing-amis.html</a></p>

<h2>
<a id="7-references-" class="anchor" href="#7-references-" aria-hidden="true"><span class="octicon octicon-link"></span></a>7. References <a name="refs"></a>
</h2>

<p><a name="calder14"></a>Calderhead B. (2014), <a href="http://www.pnas.org/content/111/49/17408.abstract">A general construction for parallelizing Metropolis-Hastings algorithms</a>, PNAS, Vol: 111, Pages: 17408-17413</p>
      </section>
      <footer>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
